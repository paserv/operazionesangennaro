<!DOCTYPE HTML>
<html>
<head>
<title>Time Graphs</title>
<link rel="stylesheet" href="../css/styles_time.css" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="../css/jquery-ui-timepicker-addon.css" />
</head>
<body>

<select id="local">
		<option value="notlocal">online</option>
		<option value="local">debug</option>
</select>





<div class="topArea">

<div class="header">
	Graph Type: 
	<select id="graphType">
		<option value="line">line</option>
	</select>
	Transmission: 
	<select id="transmission">
		<option value="ballaro">ballaro</option>
		<option value="che_tempo_che_fa">che_tempo che fa</option>
		<option value="le_iene">le iene</option>
		<option value="piazza_pulita">piazza pulita</option>
		<option value="servizio_pubblico">servizio pubblico</option>
		<option value="the_voice_ite">the_voice_ite</option>
	</select>
	Monitored Entity: 
	<select id="monitoredEntity">
		<option value="likes">likes</option>
		<option value="talkingabout">talkingabout</option>
	</select>
	From: 
	<input type="text" id="from" />
	To: 
	<input type="text" id="to" />
	<button id="btnSearch">Get Likes</button>
</div>

<!-- 
<ul id="searchList"></ul>
 -->
</div>


<div class="mainArea">
	<div id="container" style="width:100%; height:400px;"></div>
</div>


<script type="text/javascript" src="../js/jquery-2.0.0.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.10.3.js"></script>
<script type="text/javascript" src="../js/graph_common.js"></script>
<script type="text/javascript" src="../js/highstock.js"></script>
<script type="text/javascript" src="../js/jquery-ui-timepicker-addon.js"></script>

<script>
$(function() {
	$('#from').datetimepicker({dateFormat: "dd-mm-yy", timeFormat: "HH:mm:ss"});
	$('#to').datetimepicker({dateFormat: "dd-mm-yy", timeFormat: "HH:mm:ss"});
});


function render(rootURL) {
    $.ajax({
        type: 'GET',
        url: rootURL + "time/" + $('#monitoredEntity').val() + "/" + $('#transmission').val() + "/" + $('#from').val() + "/" + $('#to').val(),
        dataType: "json", // data type of response
        //provare success: return data
        success: function(data) {
            renderStockGraph(data);
        }
    });
}


function renderStockGraph(data) { 
    var jsonObj= [];
    
    $.each(data, function() {
        $.each(this, function(key, value) {
            var year = this.axis.substring(6,10);
            var month = this.axis.substring(3,5);
            var day = this.axis.substring(0,2);
            var hour = this.axis.substring(11,13);
            var min = this.axis.substring(14,16);           
            jsonObj.push([new Date(year, --month, day, (++hour) + 1, min).getTime(), parseInt(this.ordinate)]);
        });
    });
    
    $('#container').highcharts('StockChart', {

        rangeSelector : {
            selected : 1
        },
        
        title: {
            text: 'Andamento ' + $('#monitoredEntity').val()
        },
        
        yAxis: {
            title: {
                text: $('#monitoredEntity').val()
            }
        },
        
        series: [{
            name: $('#transmission').val(),
            data: jsonObj
        }]
    });
}


/*
 * VARIE
 */

function renderList(data) {
    // JAX-RS serializes an empty list as null, and a 'collection of one' as an object (not an 'array of one')
    var list = data == null ? [] : (data instanceof Array ? data : [data]);

    $('#searchList li').remove();
    $.each(data, function() {
        $.each(this, function(key, value) {
            $('#searchList').append('<li>(' + this.axis +'): ' + this.ordinate + '</li>');
        });
    });
}
</script>
</body>
</html>